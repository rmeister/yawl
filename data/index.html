<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#F29C1F">
  <title>Wake-Up Light</title>

  <link rel="manifest" href="/manifest.json">
  <!-- Icon made by Madebyoliver (http://www.flaticon.com/authors/madebyoliver)from flaticon.com , licensed by "Creative Commons BY 3.0" -->
  <link rel="shortcut icon" type="image/x-icon" href="data:image/ico;base64,AAABAAE
    AICAAAAEAIAB+BAAAFgAAAIlQTkcNChoKAAAADUlIRFIAAAAgAAAAIAgGAAAAc3p69AAA
    BEVJREFUWIW1l1FoHFUUhr9zdzfZTcJ22mDZidSlUtAHHwQfinQKomJBFNEiVrRoYR99KihCoYog
    KqJg0Ze6iD5UWkEQfRDEIjTT+CBKffEpoCvasdA2dzdNyGazc324d2ZnN5qYMf1hB+7MOfc/5z/n
    3JmFHGiHtaG1Dv082wAgeR2TIAyCF0S5A1C5PW3wO4Bb/8cemwcwKq+etWuDjBmkAbxm7WY29Nsw
    gI2cvSBChz469JW+4OMdHJJbBnaX0eEedDgjOvRVtizrksisiwPnJAijvCCKdehna1sCnkH4HFj8
    93xiAbMXeBR4LyFLkkgC9oLIDCmQgQccSTLIRFoAjiAcy9gaoDMcUDwJNIB7suQOU8B9wN4sYRqA
    ECPEE8BbwAkd+pJx7gEfAA+5jYvO62NjeFmH/pgO/QJQAerA+y5TnP0kcAz4CBjPBiBgR2pH8Fdi
    fDvwHfAh8HoilzY+zDGBYT/wGHA3UHNKXAEuAV+DfAsmTv0s+fPAS8DjXhD9lFUmbaLsTR36+1wQ
    p7wgeluHfhk4BLwJ3MnGmAdOFiQ+1zeqBDwLvOLIfxwpy6AE2Zp7QTSPrdd0O6xNAqeAL1JycZ4l
    sT+VTYV9wKd9o85gmMY2+lOj5Avf24NMRiPKQl+slTHyGbarQYGpCGZSMJVhW1kBWTLIkrFFsTiv
    4OFqEK2O8uhZO9IC6VwWgTLQ9YKop0N/DHgDOI57Gk8rTJkswTrIKqirMawB9nrWC6Kj12dnUGIq
    QBlh2TsQdV1OKe51Mj/dvlBT2FGy5AWIb9mcHMCMQX+3cicMReARHfqHlZhJ4F0gxHAosVcAsVIY
    kR+As8BRI8wAJ21KEO8SzNjm5CmcWg4ecFzs+F0DnvSC6MuFWdcDCxdn2Hng8pC/Dv09wO8AjEO/
    pv47eYIY1IJBbhgQrgBPeEE0B7b+akxR3f8nxX8gF+DBNPsp2To52IadEBsATAD3A3PA0PukqEN/
    ikEvGGAFuCu1GM/9yWDLZt3LwB0AOvSrGZO4CJwAdrkba9ijeDo1KeTmd/4CfVMAPB36yVGfJKyL
    wK/AdXejj7CCcUNEPvWHYNJrH8MqwjyDtDpFL4hOZ+2vxR6FucofyVp6Tso8iIG+AaEHRN7BaA14
    J2tS7DTrRbIH6Rmj4tt6lxKRZNlgSjn6wIBaIVGgi+EXgE6zXnIWguuBB7CzatEV1G+lqXh3H0Fi
    lkF12VotBCTGTkC3oIA12jLROV0/THJEWSxKp1n/ikETxmn8fZZSs5itQxjoKghCBUmbL3l96SFt
    O8163mpvBXG10UqbXBwx2C+ZF28yuQBt4Fy10foZhuuxij1+BSt6HuE3gsKO3w1gOY2o06xTbbSG
    LDvN+hSwcxvJDbBYbbTaGQ6qjdb6v2adZl0BLwDPsX0q9IBvqo3Wq6MPiuttiYFPgPNsw0GY2fPq
    plauGW8abvb+ufA3m1aaRaGAJf4AAAAASUVORK5CYII=" sizes="32x32">

    
<style type="text/css">
html{ height: 100%;}
body {
  font-family: Tahoma, sans-serif;
  background: midnightblue;
  color: white;
  text-align: center;
  margin: 0 auto;
  min-height: 100%;
}
#header {
  background: #F29C1F;
  height: 125px;
  padding-top: 1em;
  width: 100%;
  margin-bottom: 5em;
}
#sun {
  width: 200px;
}
input {
  color: white;
  text-align: center;
}
input[type=time] {
  font-size: 2em;
  border: 0px;
  background: midnightblue;
  width: auto;
}
input[type=checkbox]{
}
button {
  background: midnightblue;
  color: darkslateblue;
  border: 0px;
  padding: 0.5em;
}
input[type=range] {
  -webkit-appearance: none;
  width: 85%;
  margin: 5px 0;
}
input[type=range]::-webkit-slider-runnable-track {
  width: 100%;
  height: 7px;
  cursor: pointer;
  background: white; 
  /*background: #EDE21B;*/
}
input[type=range]::-webkit-slider-thumb {
  height: 24px;
  width: 24px;
  border-radius: 15px;
  background: #F29C1F;
  cursor: pointer;
  -webkit-appearance: none;
  margin-top: -8px;
}
#wrSettings{
  display: none;
}
#wrSettings input{
  width: 60%;
}
#wrSettings input::-webkit-slider-runnable-track {
  height: 2px;
}
#wrSettings input::-webkit-slider-thumb {
  height: 16px;
  width: 16px;
  margin-top: -7px;
}
.slider{
  position: absolute;
  bottom: 0px;
  left: 0px;
  width: 100%;
  background: dodgerblue;
  padding-top: 1.25em;
  padding-bottom: 1.25em;
}
</style>

<script type="text/javascript">
  function ge(s){ return document.getElementById(s);}
  function se(obj){
    ge('time').value = convBack(obj['time']);
    ge('daily').checked = obj['daily'] == 1 ? true : false;
    ge('duration').value = obj['duration'] /60;
    ge('dLable').textContent = obj['duration'] /60;
    ge('timeout').value = obj['timeout'] /60;
    ge('tLable').textContent = obj['timeout'] /60;
    ge('value').value = obj['value'] /5;
  }
  var ws = null;

  function startSocket(){
    ws = new WebSocket('ws://'+document.location.host+':81/ws');
    //ws.binaryType = "arraybuffer";
    ws.onopen = function(e){
      console.log("Connected");
      var d = new Date();
      var dWithTZone = parseInt(d.getTime()/1000) - d.getTimezoneOffset()*60;
      ws.send( JSON.stringify({ date: dWithTZone}));
    };
    ws.onclose = function(e){
      console.log("Disconnected");
    };
    ws.onerror = function(e){
      console.log("ws error", e);
    };
    ws.onmessage = function(e){
      var msg = "";
      if(e.data instanceof ArrayBuffer){
        msg = "BIN:";
        var bytes = new Uint8Array(e.data);
        for (var i = 0; i < bytes.length; i++) {
          msg += String.fromCharCode(bytes[i]);
        }
      } else {
        msg = "TXT:" + e.data;
        se(JSON.parse(e.data));
      }
      console.log(msg);
    };
  }

	function send(field, value){
		var updMsg = JSON.stringify({ [field] : value});
    if (typeof ws === 'object' && ws.readyState == 1) {
		  console.log("WS sending: "+ updMsg);
		  ws.send(updMsg);
    }
	}

	function conv(time){
		var t = time.split(":");
    var hours = t[0];
    var mins = t[1];
		var d = new Date((hours*60*60+mins*60)*1000);
		return d.getTime()/1000;
	}

  function convBack(secs){
    var aTime = new Date();
    var secsTZCorrect = (secs + aTime.getTimezoneOffset()*60) *1000;
    aTime.setTime(secsTZCorrect);
    return pad(aTime.getHours()) + ":" + pad(aTime.getMinutes());
  }
  function pad(num){
    var s = "0"+num;
    return s.substr(s.length-2);
  }

  var buttonState = false;
  function showSettings(button){
    buttonState = !buttonState;
    ge("wrSettings").style.display = buttonState ? 'block' : 'none';
  }

</script>
</head>

<body onload="startSocket()">
  <div id="header">
    <svg version="1.1" id="sun" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="0 0 60 60" style="enable-background:new 0 0 60 60;" xml:space="preserve">
    <g>
      <path style="fill:#F0C419;" d="M30,3c-0.552,0-1,0.448-1,1v6c0,0.552,0.448,1,1,1s1-0.448,1-1V4C31,3.448,30.552,3,30,3z"/>
      <path style="fill:#F0C419;" d="M59,32h-6c-0.552,0-1,0.448-1,1s0.448,1,1,1h6c0.552,0,1-0.448,1-1S59.552,32,59,32z"/>
      <path style="fill:#F0C419;" d="M7,32H1c-0.552,0-1,0.448-1,1s0.448,1,1,1h6c0.552,0,1-0.448,1-1S7.552,32,7,32z"/>
      <path style="fill:#F0C419;" d="M52.707,10.293c-0.391-0.391-1.023-0.391-1.414,0l-5.736,5.736c-0.391,0.391-0.391,1.023,0,1.414
        c0.195,0.195,0.451,0.293,0.707,0.293s0.512-0.098,0.707-0.293l5.736-5.736C53.098,11.316,53.098,10.684,52.707,10.293z"/>
      <path style="fill:#F0C419;" d="M8.707,10.293c-0.391-0.391-1.023-0.391-1.414,0s-0.391,1.023,0,1.414l5.736,5.736
        c0.195,0.195,0.451,0.293,0.707,0.293s0.512-0.098,0.707-0.293c0.391-0.391,0.391-1.023,0-1.414L8.707,10.293z"/>
      <path style="fill:#F0C419;" d="M54.854,22.45c-0.216-0.508-0.804-0.746-1.311-0.53l-2.762,1.172
        c-0.508,0.216-0.746,0.803-0.53,1.311c0.162,0.381,0.532,0.61,0.921,0.61c0.13,0,0.263-0.026,0.39-0.08l2.762-1.172
        C54.832,23.545,55.069,22.958,54.854,22.45z"/>
      <path style="fill:#F0C419;" d="M9.049,23.457l-2.782-1.124c-0.512-0.207-1.095,0.04-1.302,0.553
        c-0.207,0.512,0.041,1.095,0.553,1.302L8.3,25.312c0.123,0.049,0.25,0.073,0.374,0.073c0.396,0,0.771-0.236,0.928-0.626
        C9.809,24.247,9.562,23.664,9.049,23.457z"/>
      <path style="fill:#F0C419;" d="M20.761,8.676c-0.216-0.509-0.804-0.747-1.311-0.53c-0.508,0.216-0.746,0.803-0.53,1.311
        l1.172,2.762c0.162,0.381,0.532,0.61,0.921,0.61c0.13,0,0.263-0.026,0.39-0.08c0.508-0.216,0.746-0.803,0.53-1.311L20.761,8.676z"
        />
      <path style="fill:#F0C419;" d="M40.114,7.966c-0.511-0.207-1.095,0.041-1.302,0.553L37.688,11.3
        c-0.207,0.512,0.041,1.095,0.553,1.302c0.123,0.049,0.25,0.073,0.374,0.073c0.396,0,0.771-0.236,0.928-0.626l1.124-2.782
        C40.874,8.756,40.626,8.173,40.114,7.966z"/>
    </g>
    <path style="fill:#F0C419;" d="M48.325,41C49.396,38.549,50,35.846,50,33c0-11.046-8.954-20-20-20s-20,8.954-20,20
      c0,2.846,0.604,5.549,1.675,8H48.325z"/>
    <path style="fill:#EDE21B;" d="M42.673,41C44.139,38.683,45,35.945,45,33c0-8.284-6.716-15-15-15s-15,6.716-15,15
      c0,2.945,0.861,5.683,2.327,8H42.673z"/>
    <g>
      <path style="fill:#F29C1F;" d="M59,40H1c-0.552,0-1,0.448-1,1s0.448,1,1,1h58c0.552,0,1-0.448,1-1S59.552,40,59,40z"/>
      <path style="fill:#F29C1F;" d="M54,45H6c-0.552,0-1,0.448-1,1s0.448,1,1,1h48c0.552,0,1-0.448,1-1S54.552,45,54,45z"/>
      <path style="fill:#F29C1F;" d="M49,50H11c-0.552,0-1,0.448-1,1s0.448,1,1,1h38c0.552,0,1-0.448,1-1S49.552,50,49,50z"/>
      <path style="fill:#F29C1F;" d="M45,55H15c-0.552,0-1,0.448-1,1s0.448,1,1,1h30c0.552,0,1-0.448,1-1S45.552,55,45,55z"/>
    </g>
    <!-- arrow -->
    <!-- <polygon style="fill:#546A79;" points="37.707,29.879 30,22.172 22.293,29.879 23.707,31.293 29,26 29,37.586 31,37.586 31,26 36.293,31.293 "/> -->
    </svg>
  </div>
	<input type="time" oninput="send('time', conv(this.value))" id="time">
	<p>
    <input type="checkbox" onchange="send('daily', this.checked)" id="daily" value="false">Repeat <button type="button" id="settings" onclick="showSettings(this)">Settings &#9881;</button>
  </p>

	<div id="wrSettings">
    Duration: <span id="dLable">20</span> min<br><input type="range" oninput="send('duration', this.value *60); ge('dLable').textContent = this.value;" id="duration" min="1" max="30" value="20"> <br>
    <br>Timeout: <span id="tLable">20</span> min<br><input type="range" oninput="send('timeout', this.value *60); ge('tLable').textContent = this.value;" id="timeout" min="0" max="60" value="20">
  </div>
	
  <div class="slider"><input type="range" oninput="send('value', this.value * 5)" id="value" min="0" max="51">
	</div>
</body>
</html>